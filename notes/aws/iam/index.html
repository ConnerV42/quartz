<!doctype html><html lang=en><head><meta charset=utf-8><meta name=description content="Related Notes   AWS Wiki  Identity Access Management IAM Identity Policy Document  List of statements that grant or deny permissions to AWS services  SID: Optional, but best practice to use Effect Action Resource   The identity needs to prove to AWS who it is (authentication) Explicit allows take effect, unless there is also an explicit deny Explicit deny statements overrule everything, nothing can overrule it  A deny statement on an IAM policy always takes precedence over an allow statement."><title>IAM</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" type=image/png href=https://wiki.connerv.com//icon.png><link href=https://wiki.connerv.com/styles.708c2658f93e3a9d323a1f9fded8f4b2.min.css rel=stylesheet><link href=https://wiki.connerv.com/styles/_light_syntax.86a48a52faebeaaf42158b72922b1c90.min.css rel=stylesheet id=theme-link><script src=https://wiki.connerv.com/js/darkmode.1fd38f434cae056438590d84cdc2b105.min.js></script>
<script src=https://wiki.connerv.com/js/util.9825137f5e7825e8553c68ce39ac9e44.min.js></script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css integrity=sha384-R4558gYOUz8mP9YWpZJjofhk+zx0AS11p36HnD2ZKj/6JR5z27gSSULCNHIRReVs crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js integrity=sha384-z1fJDqw8ZApjGO3/unPWUPsIymfsJmyrDVWC8Tv/a1HeOtGmkwNd/7xUS0Xcnvsx crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.2/dist/contrib/copy-tex.min.js integrity=sha384-ww/583aHhxWkz5DEVn6OKtNiIaLi2iBRNZXfJRiY1Ai7tnJ9UXpEsyvOITVpTl4A crossorigin=anonymous></script>
<script src=https://unpkg.com/@floating-ui/core@0.7.3></script>
<script src=https://unpkg.com/@floating-ui/dom@0.5.4></script>
<script src=https://wiki.connerv.com/js/popover.9b72b70bd35617d0635e9d15463662b2.min.js></script>
<script src=https://wiki.connerv.com/js/code-title.b35124ad8db0ba37162b886afb711cbc.min.js></script>
<script src=https://wiki.connerv.com/js/clipboard.c20857734e53a3fb733b7443879efa61.min.js></script>
<script src=https://wiki.connerv.com/js/callouts.7723cac461d613d118ee8bb8216b9838.min.js></script>
<script>const BASE_URL="https://wiki.connerv.com/",fetchData=Promise.all([fetch("https://wiki.connerv.com/indices/linkIndex.9cb4fbbe8787f936346ca7dad0af0b9a.min.json").then(e=>e.json()).then(e=>({index:e.index,links:e.links})),fetch("https://wiki.connerv.com/indices/contentIndex.e7334a58f04c8bb7bba42b0e144945d3.min.json").then(e=>e.json())]).then(([{index:e,links:t},n])=>({index:e,links:t,content:n})),render=()=>{const e=new URL(BASE_URL),t=e.pathname,n=window.location.pathname,s=t==n;addCopyButtons(),addTitleToCodeBlocks(),addCollapsibleCallouts(),initPopover("https://wiki.connerv.com",!0,!0);const o=document.getElementById("footer");if(o){const e=document.getElementById("graph-container");if(!e)return requestAnimationFrame(render);e.textContent="";const t=s&&!0;drawGraph("https://wiki.connerv.com",t,[{"/moc":"#4388cc"}],t?{centerForce:1,depth:-1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.6,linkDistance:1.2,opacityScale:2,repelForce:1.2,scale:1.4}:{centerForce:1,depth:1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.6,linkDistance:1,opacityScale:3,repelForce:2,scale:1.2})}},init=(e=document)=>{addCopyButtons(),addTitleToCodeBlocks(),renderMathInElement(e.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],macros:{'â€™':"'"},throwOnError:!1})}</script><script type=module>
    import { attachSPARouting } from "https:\/\/wiki.connerv.com\/js\/router.9d4974281069e9ebb189f642ae1e3ca2.min.js"
    attachSPARouting(init, render)
  </script></head><script async src="https://www.googletagmanager.com/gtag/js?id=G-XYFD95KB4J"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-XYFD95KB4J",{anonymize_ip:!1})}</script><body><div id=search-container><div id=search-space><input autocomplete=off id=search-bar name=search type=text aria-label placeholder><div id=results-container></div></div></div><script src=https://cdn.jsdelivr.net/npm/flexsearch@0.7.21/dist/flexsearch.bundle.js integrity="sha256-i3A0NZGkhsKjVMzFxv3ksk0DZh3aXqu0l49Bbh0MdjE=" crossorigin=anonymous defer></script>
<script defer src=https://wiki.connerv.com/js/full-text-search.24827f874defbbc6d529926cbfcfb493.min.js></script><div class=singlePage><header><h1 id=page-title><a href=https://wiki.connerv.com/>cvwiki</a></h1><div class=spacer></div><div id=search-icon><p></p><svg tabindex="0" aria-labelledby="title desc" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title id="title"/><desc id="desc"/><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"/><circle cx="8" cy="8" r="7"/></g></svg></div><div class=darkmode><input class=toggle id=darkmode-toggle type=checkbox tabindex=-1>
<label id=toggle-label-light for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="dayIcon" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35"><title/><path d="M6 17.5C6 16.672 5.328 16 4.5 16h-3C.672 16 0 16.672.0 17.5S.672 19 1.5 19h3C5.328 19 6 18.328 6 17.5zM7.5 26c-.414.0-.789.168-1.061.439l-2 2C4.168 28.711 4 29.086 4 29.5 4 30.328 4.671 31 5.5 31c.414.0.789-.168 1.06-.44l2-2C8.832 28.289 9 27.914 9 27.5 9 26.672 8.329 26 7.5 26zm10-20C18.329 6 19 5.328 19 4.5v-3C19 .672 18.329.0 17.5.0S16 .672 16 1.5v3C16 5.328 16.671 6 17.5 6zm10 3c.414.0.789-.168 1.06-.439l2-2C30.832 6.289 31 5.914 31 5.5 31 4.672 30.329 4 29.5 4c-.414.0-.789.168-1.061.44l-2 2C26.168 6.711 26 7.086 26 7.5 26 8.328 26.671 9 27.5 9zM6.439 8.561C6.711 8.832 7.086 9 7.5 9 8.328 9 9 8.328 9 7.5c0-.414-.168-.789-.439-1.061l-2-2C6.289 4.168 5.914 4 5.5 4 4.672 4 4 4.672 4 5.5c0 .414.168.789.439 1.06l2 2.001zM33.5 16h-3c-.828.0-1.5.672-1.5 1.5s.672 1.5 1.5 1.5h3c.828.0 1.5-.672 1.5-1.5S34.328 16 33.5 16zM28.561 26.439C28.289 26.168 27.914 26 27.5 26c-.828.0-1.5.672-1.5 1.5.0.414.168.789.439 1.06l2 2C28.711 30.832 29.086 31 29.5 31c.828.0 1.5-.672 1.5-1.5.0-.414-.168-.789-.439-1.061l-2-2zM17.5 29c-.829.0-1.5.672-1.5 1.5v3c0 .828.671 1.5 1.5 1.5s1.5-.672 1.5-1.5v-3C19 29.672 18.329 29 17.5 29zm0-22C11.71 7 7 11.71 7 17.5S11.71 28 17.5 28 28 23.29 28 17.5 23.29 7 17.5 7zm0 18c-4.136.0-7.5-3.364-7.5-7.5s3.364-7.5 7.5-7.5 7.5 3.364 7.5 7.5S21.636 25 17.5 25z"/></svg></label><label id=toggle-label-dark for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="nightIcon" viewBox="0 0 100 100" style="enable-background='new 0 0 100 100'"><title/><path d="M96.76 66.458c-.853-.852-2.15-1.064-3.23-.534-6.063 2.991-12.858 4.571-19.655 4.571C62.022 70.495 50.88 65.88 42.5 57.5 29.043 44.043 25.658 23.536 34.076 6.47c.532-1.08.318-2.379-.534-3.23-.851-.852-2.15-1.064-3.23-.534-4.918 2.427-9.375 5.619-13.246 9.491-9.447 9.447-14.65 22.008-14.65 35.369.0 13.36 5.203 25.921 14.65 35.368s22.008 14.65 35.368 14.65c13.361.0 25.921-5.203 35.369-14.65 3.872-3.871 7.064-8.328 9.491-13.246C97.826 68.608 97.611 67.309 96.76 66.458z"/></svg></label></div></header><article><h1>IAM</h1><p class=meta>Nov 5, 2022
<a href=https://github.com/jackyzha0/quartz/tree/hugo/content/notes/aws/iam.md rel=noopener></a></p><ul class=tags><li><a href=https://wiki.connerv.com/tags/aws/>Aws</a></li><li><a href=https://wiki.connerv.com/tags/aws-permissions/>Aws permissions</a></li></ul><aside class=mainTOC><details open><summary></summary><nav id=TableOfContents><ol><li><ol><li><a href=#related-notes>Related Notes</a></li></ol></li><li><a href=#identity-access-management><strong>Identity Access Management</strong></a><ol><li><a href=#iam-identity-policy-document>IAM Identity Policy Document</a></li><li><a href=#managed-policies>Managed Policies</a></li><li><a href=#iam-users>IAM Users</a></li><li><a href=#iam-groups>IAM Groups</a></li><li><a href=#iam-roles>IAM Roles</a></li><li><a href=#service-linked-roles>Service Linked Roles</a></li><li><a href=#saml20-identity-federation>SAML2.0 Identity Federation</a></li><li><a href=#arns>ARNs</a></li></ol></li><li><a href=#aws-sysops-scenarios>#aws-sysops Scenarios</a></li></ol></nav></details></aside><a href=#related-notes><h3 id=related-notes><span class=hanchor arialabel=Anchor># </span>Related Notes</h3></a><ul><li><a href=/notes/aws/aws-wiki/ rel=noopener class=internal-link data-src=/notes/aws/aws-wiki/>AWS Wiki</a></li></ul><a href=#identity-access-management><h2 id=identity-access-management><span class=hanchor arialabel=Anchor># </span><strong>Identity Access Management</strong></h2></a><a href=#iam-identity-policy-document><h3 id=iam-identity-policy-document><span class=hanchor arialabel=Anchor># </span>IAM Identity Policy Document</h3></a><ul><li>List of statements that grant or deny permissions to AWS services<ul><li>SID: Optional, but best practice to use</li><li>Effect</li><li>Action</li><li>Resource</li></ul></li><li>The identity needs to prove to AWS who it is (authentication)</li><li>Explicit allows take effect, unless there is also an explicit deny</li><li>Explicit deny statements overrule everything, nothing can overrule it<ul><li>A deny statement on an IAM policy always takes precedence over an allow statement. For example, if your policy allows PUT and DELETE actions to a DynamoDB table, but your policy also denies all DynamoDB actions, the policy will not allow any actions on your AWS accounts DynamoDB tables.</li></ul></li><li>Default is a implicit deny (If you&rsquo;re not allowed, you&rsquo;re denied)</li></ul><a href=#managed-policies><h3 id=managed-policies><span class=hanchor arialabel=Anchor># </span>Managed Policies</h3></a><ul><li>Reusable</li><li>Low management overhead</li><li>Good for granting access across many people that will be using AWS in your organization</li><li>AWS Managed Policies can be used, as well as Custom Managed Policies</li></ul><a href=#iam-users><h3 id=iam-users><span class=hanchor arialabel=Anchor># </span>IAM Users</h3></a><ul><li>IAM Users are an identity used for anything requiring long term AWS access e.g. Humans, Applications or service accounts</li><li>Principal = An unidentified entity, not yet authenticated or authorized, attempting to access an AWS account</li><li>Principals make requests to IAM in order to be authenticated</li><li>Principal claims to be Sally, and proves by authenticating using a Username/Password (Console UI) or Access Key (application/cli)</li><li>Authenticated Identity is an entity that has proved it is authenticated</li><li>Once an authenticated Identity tries to do something like terminate an EC2 instance, or upload to an S3 bucket, AWS checks that that Identity is authorized to perform that action, and that is the process of authorization</li></ul><a href=#iam-user-limits><h4 id=iam-user-limits><span class=hanchor arialabel=Anchor># </span>IAM User Limits</h4></a><ul><li>5,000 IAM Users per account</li><li>IAM Users can only be a member of 10 groups</li><li>This has systems design impacts&mldr;</li><li>Internet-scale applications, large orgs & org merges</li><li>IAM Roles & Identity Federation fix this</li></ul><a href=#iam-groups><h3 id=iam-groups><span class=hanchor arialabel=Anchor># </span>IAM Groups</h3></a><ul><li>IAM Groups are containers for IAM Users</li><li>You cannot log into a group</li><li>Used solely for organization of IAM Users</li><li>There is no &ldquo;All Users&rdquo; group in IAM, unless you create one and manage it yourself</li><li>No nested groups</li><li>Groups are not a true identity. They can&rsquo;t be referenced as a principal in a policy</li><li>Groups offer less functionality than you would think, keep this in mind</li></ul><a href=#iam-roles><h3 id=iam-roles><span class=hanchor arialabel=Anchor># </span>IAM Roles</h3></a><ul><li>A role is a type of identity that exists in AWS</li><li>If you cannot identify the number of principals that use an IAM User, it could be a good candidate for a role<ul><li>One example is a <code>company-microservice-dev</code> role, which is used by multiple IAM Users (in the form of software engineers, that want to use that role to access resources related to that particular service, in a development account)</li></ul></li><li>Roles are generally used on a temporary basis, to use the role&rsquo;s permissions to perform some actions, and then stop using that role</li><li>IAM users can have identity permissions policies attached to them via inline JSON or managed policies</li><li>IAM roles have 2 types of policies that can be attached<ul><li>Trust Policy - Controls which identities can assume the role</li><li>Permissions Policy - Controls which permissions the role has authorization to perform</li></ul></li><li>If a role is assumed by something which is allowed to assume it, AWS generates a temporary set of security credentials using the AWS STS (Secure Token Service), which are time limited</li><li>Roles can be referenced within resource policies</li></ul><p>When might you use roles?</p><ul><li>AWS Lambda (Lambda assumes Lambda Execution Role at invocation time to read/write to an S3 bucket)</li><li>Single Sign-on or >5000 Identities</li><li>External accounts can&rsquo;t be used in AWS Directly</li><li>Designing an architecture for a popular mobile application with millions of users<ul><li>Because of the 5000 user limit, your users would need a role to interact<ul><li>This is good because there are no AWS credentials on the app<ul><li>Scales to 100,000,000&rsquo;s of accounts</li></ul></li></ul></li></ul></li><li>Cross account permissions</li></ul><a href=#service-linked-roles><h3 id=service-linked-roles><span class=hanchor arialabel=Anchor># </span>Service Linked Roles</h3></a><ul><li>An IAM Role linked to a specific AWS service</li><li>Provides a set of permissions, which are predefined by a service</li><li>Provides permissions that a service needs to interact with other AWS services on your behalf</li><li>Service might create/delete the role or allow you to create the role during the setup or within IAM</li><li>Key Difference: You cannot delete a service linked role until it&rsquo;s no longer required</li><li>To create a role, you need <code>iam:CreateServiceLinkedRole</code> attached to an AWS service role</li><li>You also need <code>iam:AttachRolePolicy</code> and <code>iam:PutRolePolicy</code></li></ul><a href=#saml20-identity-federation><h3 id=saml20-identity-federation><span class=hanchor arialabel=Anchor># </span>SAML2.0 Identity Federation</h3></a><ul><li>Identity Federation is the process of using an identity from another identity provider to access AWS resources.</li><li>In AWS though, this can&rsquo;t be direct. Only AWS credentials can be used to access AWS resources.</li><li>So, some form of exchange is required.</li><li>SAML 2.0 stands for Security Assertion Markup Language (V2 of the standard)</li><li>Open standard used by many ldP&rsquo;s (e.g. MS ADFS)</li><li>Indirectly use on-premises IDs with AWS (Console & CLI)</li><li>SAML is used, when you currently use an Enterprise Identity Provider that is also SAML 2.0 Compatible</li><li>You wouldn&rsquo;t use it with Google, Facebook, Twitter</li><li>You would use it if you have an existing identity management team</li><li>You would use it if you require a single source of truth with more than 5,000 users</li><li>Uses IAM Roles & AWS Temporary Credentials (12 hour validity)</li><li>YOU CANNOT USE EXTERNAL IDENTITIES TO DIRECTLY ACCESS AWS. There is always an exchange, and you get temporary role based credentials.</li></ul><a href=#apicli-credential-process><h4 id=apicli-credential-process><span class=hanchor arialabel=Anchor># </span>API/CLI Credential Process</h4></a><ul><li>The Identity Provider (e.g ADFS) establishes a two way trust with IAM<ul><li>AWS registered in IDP, SAML IdP created in IAM - two way trust</li><li>AWS Account is configured to allow SAML2.0 based federation</li></ul></li><li>SAML communicates with IAM to fetch credentials by using the <code>sts:AssumeRoleWithSAML</code> permission</li><li>IAM Role Assumed and Temporary Security Credentials are returned</li><li>Now the on-premises application can access, say, a DynamoDB using said credentials</li></ul><a href=#console-credential-process><h4 id=console-credential-process><span class=hanchor arialabel=Anchor># </span>Console Credential Process</h4></a><ul><li>Mostly the same, but now it&rsquo;s a user who wants to access the API console</li><li>There is still a trust configured, but this time it is between the Identity Provider (e.g ADFS) and the SAML/SSO endpoint in AWS Account</li><li>Temporary security credentials are created, and a temporary set of sign on credentials are created, as well as a console sign-in URL with credentials</li><li>SAML endpoint constructs this sign-in URL, and gives it to the user/client</li></ul><a href=#arns><h3 id=arns><span class=hanchor arialabel=Anchor># </span>ARNs</h3></a><ul><li>Uniquely identify resources within any AWS accounts</li><li><code>arn:partition:service:region:account-id:resource-type/resource-id</code></li></ul><a href=#aws-sysops-scenarios><h2 id=aws-sysops-scenarios><span class=hanchor arialabel=Anchor># </span>#aws-sysops Scenarios</h2></a><hr><p><strong>Question</strong>: A SysOps Administrator needs to grant a user the ability to pass any of the approved set of roles to the Amazon EC2 service upon launching an instance. This will enable the user to start an EC2 instance with an assigned role. In effect, the applications running on the instance can access temporary credentials for the role through the instance profile metadata. What must the Administrator do to accomplish this requirement?
<strong>Answer</strong>: To configure many AWS services, you must pass an IAM role to the service. This allows the service to later assume the role and perform actions on your behalf. You only have to pass the role to the service once during setup, and not every time the service assumes the role. For example, assume that you have an application running on an Amazon EC2 instance. That application requires temporary credentials for authentication, and permissions to authorize the application to perform actions in AWS. When you set up the application you must pass a role to EC2 to use with the instance that provides those credentials. You define the permissions for the applications running on the instance by attaching an IAM policy to the role. The application assumes the role every time it needs to perform the actions that are allowed by the role.
To pass a role (and it&rsquo;s permissions) to an AWS service, a user must have permissions to pass the role to the service. This helps administrators ensure that only approved users can configure a service with a role that grants permissions. To allow a user to pass a role to an AWS service, you must grant the <code>PassRole</code> permission to the user&rsquo;s IAM user, role, or group.
If you want to grant a user the ability to pass any of an approved set of roles to the Amazon EC2 service upon launching an instance, you need these three elements:</p><ol><li>An IAM permissions policy attached to the role determines what the role can do. You should scope permissions to only the actions that the role must perform, and to only the resources that the role needs for those actions.</li><li>A trust policy for the role that allows the service to assume the role. You could attach a trust policy to the role with the <code>UpdateAssumeRolePolicy</code> action. With a trust policy, it allows Amazon EC2 to use the role and the permissions attached to the role.</li><li>Another IAM permissions policy which is attached to the IAM user allows the user to pass only those roles that are approved. The <code>iam:PassRole</code> permission usually is accompanied by <code>iam:GetRole</code> permission so that the user can get the details of the role to be passed.</li></ol><hr><p><strong>Question</strong>: An administrator has launched new AWS accounts. Management wants that IAM users across all accounts be able to sign in using a single login URL as shown below:</p><p><code>https://connerv.signin.aws.amazon.com/console</code></p><p>How can the administrator meet the requirement?</p><p><strong>Answer</strong>: Having a single login URL for different AWS accounts is not possible.</p><p>The AWS account root user and AWS Identity and Access Management (IAM) users in the account sign in using a web URL. The sign-in page URL for your account&rsquo;s IAM users has the following format, by default: <code>https://123456789123.signin.aws.amazon.com/console/</code></p><p>If you create an AWS account alias for your AWS account ID, the IAM user sign-in page URL looks like the following example: <code>https://connerv.signin.aws.amazon.com/console</code></p><p>Your AWS account can only have one alias. If you create a new alias for your AWS account, the new alias overwrites the previous alias. The URL containing the previous alias stops working. Also, the account alias must be unique across all AWS products and must contain only lowercase letters, digits, and hyphens.</p></article><hr><div class=page-end id=footer><div class=backlinks-container><h3></h3><ul class=backlinks><li><a href=/notes/aws/aws-wiki/ data-ctx=IAM data-src=/notes/aws/aws-wiki class=internal-link>AWS Wiki</a></li><li><a href=/notes/aws/iam-identity-center/ data-ctx=IAM data-src=/notes/aws/iam-identity-center class=internal-link>IAM Identity Center</a></li></ul></div><div><script src=https://cdn.jsdelivr.net/npm/d3@6.7.0/dist/d3.min.js integrity="sha256-+7jaYCp29O1JusNWHaYtgUn6EhuP0VaFuswhNV06MyI=" crossorigin=anonymous></script><h3></h3><div id=graph-container></div><style>:root{--g-node:var(--secondary);--g-node-active:var(--primary);--g-node-inactive:var(--visited);--g-link:var(--outlinegray);--g-link-active:#5a7282}</style><script src=https://wiki.connerv.com/js/graph.abd4bc2af3869a96524d7d23b76152c7.js></script></div></div><div id=contact_buttons><footer><p></p><ul><li><a href=https://wiki.connerv.com/></a></li></ul></footer></div></div></body></html>